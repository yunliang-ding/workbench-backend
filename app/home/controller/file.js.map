{
    "version": 3,
    "sources": [
        "../../../src/home/controller/file.js"
    ],
    "names": [
        "config",
        "require",
        "dirTree",
        "uuidv1",
        "fse",
        "fs",
        "exec",
        "toCode",
        "code",
        "newCCode",
        "i",
        "length",
        "String",
        "fromCharCode",
        "charCodeAt",
        "fromCode",
        "__before",
        "cookie",
        "token",
        "User",
        "http",
        "url",
        "json",
        "isError",
        "message",
        "data",
        "isloginAction",
        "loginAction",
        "post",
        "username",
        "password",
        "httponly",
        "queryContent",
        "res",
        "_data",
        "type",
        "push",
        "concat",
        "children",
        "content",
        "readFileSync",
        "path",
        "filelistAction",
        "param",
        "get",
        "extensions",
        "exclude",
        "console",
        "log",
        "error",
        "getfileAction",
        "readFile",
        "savefileAction",
        "existsSync",
        "exist",
        "outputFile",
        "toString",
        "newAction",
        "fileCommand",
        "deleteAction",
        "newfolderAction",
        "renameAction",
        "cmd",
        "resolve",
        "err",
        "stdout",
        "stderr",
        "split",
        "filter",
        "_stdout",
        "downloadAction",
        "name",
        "slice",
        "download",
        "Base"
    ],
    "mappings": "AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;;;AACA;;;;AACA,IAAMA,SAASC,QAAQ,0BAAR,CAAf;AACA,IAAMC,UAAUD,QAAQ,gBAAR,CAAhB;AACA,IAAME,SAASF,QAAQ,SAAR,CAAf;AACA,IAAMG,MAAMH,QAAQ,UAAR,CAAZ;AACA,IAAMI,KAAKJ,QAAQ,IAAR,CAAX;;eACiBA,QAAQ,eAAR,C;IAATK,I,YAAAA,I;;;;;;;;;;;;;;gJAoBNC,M,GAAS,UAACC,IAAD,EAAU;AAAG;AACpB,UAAIC,WAAW,EAAf;AACA,WAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,KAAKG,MAAzB,EAAiCD,GAAjC,EAAsC;AACpCD,oBAAYG,OAAOC,YAAP,CAAoBL,KAAKE,CAAL,EAAQI,UAAR,KAAuB,CAA3C,CAAZ;AACD;AACD,aAAOL,QAAP;AACD,K,QACDM,Q,GAAW,UAACP,IAAD,EAAU;AAAE;AACrB,UAAIC,WAAW,EAAf;AACA,WAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,KAAKG,MAAzB,EAAiCD,GAAjC,EAAsC;AACpCD,oBAAYG,OAAOC,YAAP,CAAoBL,KAAKE,CAAL,EAAQI,UAAR,KAAuB,CAA3C,CAAZ;AACD;AACD,aAAOL,QAAP;AACD,K;;;AA/BD;;;mBAGAO,Q,uBAAW;AACT;AACA;AACA;AACA;AAJS,kBAKO,KAAKC,MAAL,EALP;AAAA,QAKHC,KALG,WAKHA,KALG;;AAMT,QAAIC,WAAKD,KAAL,KAAeA,KAAf,IAAwB,KAAKE,IAAL,CAAUC,GAAV,KAAkB,aAA9C,EAA6D;AAC3D,WAAKC,IAAL,CAAU;AACRd,cAAM,GADE;AAERe,iBAAS,IAFD;AAGRC,iBAAS,MAHD;AAIRC,cAAM;AAJE,OAAV;AAMD;AACF,G;;mBAeKC,a;;;;;;;;yBACY,KAAKT,MAAL,E,EAAVC,K,YAAAA,K;;AACN,mBAAKI,IAAL,CAAU;AACRd,sBAAMW,WAAKD,KAAL,KAAeA,KAAf,GAAuB,GAAvB,GAA6B;AAD3B,eAAV;;;;;;;;;;;;;;;;;mBAIIS,W;;;;;;;;sBAC2B,KAAKC,IAAL,E,EAAvBC,Q,SAAAA,Q,EAAUC,Q,SAAAA,Q;;AAClB,kBAAID,aAAa7B,OAAO6B,QAApB,IAAgCC,aAAa9B,OAAO8B,QAAxD,EAAkE;AAChEX,2BAAKD,KAAL,GAAaf,QAAb,CADgE,CAC1C;AACtB,qBAAKc,MAAL,CAAY,OAAZ,EAAqBE,WAAKD,KAA1B,EAAiC;AAC/B;AACAa,4BAAU,IAFqB,CAEhB;AAFgB,iBAAjC;AAIA,qBAAKT,IAAL,CAAU;AACRC,2BAAS,KADD;AAERC,2BAAS;AAFD,iBAAV;AAID,eAVD,MAUO;AACL,qBAAKF,IAAL,CAAU;AACRd,wBAAM,GADE;AAERe,2BAAS,IAFD;AAGRC,2BAAS;AAHD,iBAAV;AAKD;;;;;;;;;;;;;;;;;mBAEGQ,Y;2GAAaP,I;;;;;;;AACbQ,iB,GAAM,E;;AACV,mBAASvB,CAAT,GAAa,CAAb,EAAgBA,IAAIe,KAAKd,MAAzB,EAAiCD,GAAjC,EAAsC;AAChCwB,qBADgC,GACxBT,KAAKf,CAAL,CADwB;;AAEpC,oBAAIwB,MAAMC,IAAN,KAAe,WAAnB,EAAgC;AAC9BF,sBAAIG,IAAJ,CAASF,KAAT;AACAD,sBAAII,MAAJ,CAAW,KAAKL,YAAL,CAAkBE,MAAMI,QAAxB,CAAX;AACD,iBAHD,MAGO;AACLJ,wBAAMK,OAAN,GAAgBnC,IAAIoC,YAAJ,CAAiBN,MAAMO,IAAvB,EAA6B,MAA7B,CAAhB;AACAR,sBAAIG,IAAJ,CAASF,KAAT;AACD;AACF;gDACMD,G;;;;;;;;;;;;;;;;;mBAEHS,c;;;;;;;AACAC,mB,GAAQ,KAAKC,GAAL,CAAS,aAAT,IAA0B;AACpCC,4BAAY,oBADwB;AAEpCC,yBAAS;AAF2B,eAA1B,GAGR;AACAA,yBAAS;AADT,e;;AAIIrB,kB,GAAOvB,QAAQ,KAAK0C,GAAL,CAAS,MAAT,CAAR,EAA0BD,KAA1B,C;;mBACT,KAAKC,GAAL,CAAS,aAAT,C;;;;;;qBACoB,KAAKZ,YAAL,CAAkBP,KAAKa,QAAvB,C;;;AAAtBb,mBAAKa,Q;;;AAEP,mBAAKhB,IAAL,CAAU;AACRG,0BADQ;AAERF,yBAAS;AAFD,eAAV;;;;;;;;AAKAwB,sBAAQC,GAAR;AACA,mBAAK1B,IAAL,CAAU;AACR2B,mCADQ;AAER1B,yBAAS;AAFD,eAAV;;;;;;;;;;;;;;;;;mBAME2B,a;;;;;;;;;qBAEiB9C,IAAI+C,QAAJ,CAAa,KAAKP,GAAL,CAAS,MAAT,CAAb,EAA+B,MAA/B,C;;;AAAbnB,kB;;AACN,mBAAKH,IAAL,CAAU;AACRG,sBAAM,KAAKlB,MAAL,CAAYkB,IAAZ,CADE;AAERF,yBAAS;AAFD,eAAV;;;;;;;;AAKAwB,sBAAQC,GAAR;AACA,mBAAK1B,IAAL,CAAU;AACR2B,mCADQ;AAER1B,yBAAS;AAFD,eAAV;;;;;;;;;;;;;;;;;mBAME6B,c;;;;;;;;;qBAEkB/C,GAAGgD,UAAH,CAAc,KAAKzB,IAAL,CAAU,MAAV,CAAd,C;;;AAAd0B,mB;;mBACFA,K;;;;;AACFlD,kBAAImD,UAAJ,CAAe,KAAK3B,IAAL,CAAU,MAAV,CAAf,EAAkC,KAAKrB,MAAL,CAAY,KAAKqB,IAAL,CAAU,SAAV,CAAZ,EAAkC4B,QAAlC,EAAlC;AACA,mBAAKlC,IAAL,CAAU;AACRC,yBAAS;AADD,eAAV;;;;;oBAIO,mB;;;;;;;;;;AAGTwB,sBAAQC,GAAR;AACA,mBAAK1B,IAAL,CAAU;AACR2B,mCADQ;AAER1B,yBAAS;AAFD,eAAV;;;;;;;;;;;;;;;;;mBAMEkC,S;;;;;;;;;;qBAE8B,KAAKC,WAAL,SAAuB,KAAK9B,IAAL,CAAU,MAAV,CAAvB,eAAkD,KAAKA,IAAL,CAAU,UAAV,CAAlD,C;;;;AAAxBH,kB,SAAAA,I;AAAMF,qB,SAAAA,O;;AACd,mBAAKD,IAAL,CAAU;AACRG,0BADQ;AAERF;AAFQ,eAAV;;;;;;;;AAKAwB,sBAAQC,GAAR;AACA,mBAAK1B,IAAL,CAAU;AACR2B,mCADQ;AAER1B,yBAAS;AAFD,eAAV;;;;;;;;;;;;;;;;;mBAMEoC,Y;;;;;;;;;;qBAE8B,KAAKD,WAAL,SAAuB,KAAK9B,IAAL,CAAU,MAAV,CAAvB,gBAAmD,KAAKA,IAAL,CAAU,UAAV,CAAnD,C;;;;AAAxBH,kB,UAAAA,I;AAAMF,qB,UAAAA,O;;AACd,mBAAKD,IAAL,CAAU;AACRG,0BADQ;AAERF;AAFQ,eAAV;;;;;;;;AAKAwB,sBAAQC,GAAR;AACA,mBAAK1B,IAAL,CAAU;AACR2B,mCADQ;AAER1B,yBAAS;AAFD,eAAV;;;;;;;;;;;;;;;;;mBAMEqC,e;;;;;;;;;;qBAE8B,KAAKF,WAAL,SAAuB,KAAK9B,IAAL,CAAU,MAAV,CAAvB,eAAkD,KAAKA,IAAL,CAAU,YAAV,CAAlD,C;;;;AAAxBH,kB,UAAAA,I;AAAMF,qB,UAAAA,O;;AACd,mBAAKD,IAAL,CAAU;AACRG,0BADQ;AAERF;AAFQ,eAAV;;;;;;;;AAKAwB,sBAAQC,GAAR;AACA,mBAAK1B,IAAL,CAAU;AACR2B,mCADQ;AAER1B,yBAAS;AAFD,eAAV;;;;;;;;;;;;;;;;;mBAMEsC,Y;;;;;;;;;;qBAEkBxD,GAAGgD,UAAH,CAAc,KAAKzB,IAAL,CAAU,MAAV,IAAoB,GAApB,GAA0B,KAAKA,IAAL,CAAU,SAAV,CAAxC,C;;;AAAd0B,mB;;AACNP,sBAAQC,GAAR,CAAY,KAAKpB,IAAL,CAAU,MAAV,IAAoB,GAApB,GAA0B,KAAKA,IAAL,CAAU,SAAV,CAAtC;;kBACK0B,K;;;;;;qBAC6B,KAAKI,WAAL,SAAuB,KAAK9B,IAAL,CAAU,MAAV,CAAvB,YAA+C,KAAKA,IAAL,CAAU,SAAV,CAA/C,SAAuE,KAAKA,IAAL,CAAU,SAAV,CAAvE,C;;;;AAAxBH,kB,UAAAA,I;AAAMF,qB,UAAAA,O;;AACd,mBAAKD,IAAL,CAAU;AACRG,0BADQ;AAERF;AAFQ,eAAV;;;;;oBAKU,KAAKK,IAAL,CAAU,SAAV,C;;;;;;;;;;AAGZmB,sBAAQC,GAAR;AACA,mBAAK1B,IAAL,CAAU;AACR2B,oCADQ;AAER1B,yBAAS;AAFD,eAAV;;;;;;;;;;;;;;;;;mBAMEmC,W;6GAAYI,G;;;;;;;;qBAEK,sBAAY,UAACC,OAAD,EAAa;AAC1CzD,qBAAKwD,GAAL,EAAU,UAACE,GAAD,EAAMC,MAAN,EAAcC,MAAd,EAAyB;AACjCnB,0BAAQC,GAAR,CAAY,QAAZ,EAAsBgB,GAAtB;AACA,sBAAIA,QAAQ,IAAZ,EAAkB;AAChB,wBAAIE,WAAW,EAAf,EAAmB;AACjBD,+BAASC,SAASD,MAAlB;AACD;AACDF,4BAAQ;AACNxC,+BAAS,KADH;AAENC,+BAAS,IAFH;AAGNC,4BAAMwC,UAAUA,OAAOE,KAAP,CAAa,IAAb,EAAmBC,MAAnB,CAA0B,mBAAW;AACnD,+BAAOC,YAAY,EAAnB;AACD,uBAFe,CAHV;AAMNH;AANM,qBAAR;AAQD,mBAZD,MAYO;AACLH,4BAAQ;AACNxC,+BAAS,IADH;AAENC,+BAAS0C;AAFH,qBAAR;AAID;AACF,iBApBD;AAqBD,eAtBkB,C;;;AAAbzC,kB;iDAuBCA,I;;;;;;AAEPsB,sBAAQC,GAAR;iDACO;AACLzB,yBAAS,IADJ;AAEL0B;AAFK,e;;;;;;;;;;;;;;;;;mBAMLqB,c;;;;;;;;qBACiB,KAAK1B,GAAL,E,EAAfH,I,QAAAA,I,EAAMN,I,QAAAA,I;AACRoC,kB,GAAO9B,KAAK0B,KAAL,CAAW,GAAX,EAAgBK,KAAhB,CAAsB,CAAC,CAAvB,EAA0B,CAA1B,C;;oBACPrC,SAAS,K;;;;;;qBAEL,KAAKuB,WAAL,SAAuBjB,IAAvB,iBAAuC8B,IAAvC,c;;;AACN9B,4BAAY8B,IAAZ,U,CAAuB;AACvB,mBAAKE,QAAL,CAAchC,IAAd,EAAoB8B,OAAO,MAA3B;;;;;AAEA,mBAAKE,QAAL,CAAchC,IAAd,EAAoB8B,IAApB;;;;;;;;;;;;;;;;;;EAhPuBG,c",
    "file": "../../../src/home/controller/file.js",
    "sourcesContent": [
        "'use strict';\nimport Base from './base.js'\nimport { User } from './user'\nconst config = require('../../../www/config.json')\nconst dirTree = require(\"directory-tree\")\nconst uuidv1 = require('uuid/v1')\nconst fse = require('fs-extra')\nconst fs = require('fs')\nconst { exec } = require('child_process')\nexport default class extends Base {\n  /**\n   * @return {Promise} []\n   */\n  __before() {\n    // this.header('Access-Control-Allow-Origin', this.header('origin') || '*');\n    // this.header('Access-Control-Allow-Headers', 'x-requested-with');\n    // this.header('Access-Control-Request-Method', 'GET,POST,PUT,DELETE');\n    // this.header('Access-Control-Allow-Credentials', 'true');\n    let { token } = this.cookie()\n    if (User.token !== token && this.http.url !== '/file/login') {\n      this.json({\n        code: 403,\n        isError: true,\n        message: '需要登录',\n        data: []\n      })\n    }\n  }\n  toCode = (code) => {  //加密字符串\n    let newCCode = ''\n    for (let i = 0; i < code.length; i++) {\n      newCCode += String.fromCharCode(code[i].charCodeAt() - 1)\n    }\n    return newCCode\n  }\n  fromCode = (code) => { //解密字符串\n    let newCCode = ''\n    for (let i = 0; i < code.length; i++) {\n      newCCode += String.fromCharCode(code[i].charCodeAt() + 1)\n    }\n    return newCCode\n  }\n  async isloginAction(){\n    let { token } = this.cookie()\n    this.json({\n      code: User.token !== token ? 403 : 200\n    })\n  }\n  async loginAction() {\n    const { username, password } = this.post()\n    if (username === config.username && password === config.password) {\n      User.token = uuidv1() // 生成用户的token\n      this.cookie('token', User.token, {\n        // domain: this.header('origin'),\n        httponly: true // 只能通过http请求\n      })\n      this.json({\n        isError: false,\n        message: '登录成功'\n      })\n    } else {\n      this.json({\n        code: 403,\n        isError: true,\n        message: '需要登录'\n      })\n    }\n  }\n  async queryContent(data) {\n    let res = []\n    for (let i = 0; i < data.length; i++) {\n      let _data = data[i]\n      if (_data.type === 'directory') {\n        res.push(_data)\n        res.concat(this.queryContent(_data.children))\n      } else {\n        _data.content = fse.readFileSync(_data.path, 'utf8')\n        res.push(_data)\n      }\n    }\n    return res\n  }\n  async filelistAction() {\n    let param = this.get('createModel') ? {\n      extensions: /\\.js|.jsx|.ts|.tsx/,\n      exclude: /node_modules|.DS_Store|.git/\n    } : {\n        exclude: /node_modules|.DS_Store/\n      }\n    try {\n      const data = dirTree(this.get('path'), param)\n      if (this.get('createModel')) {\n        data.children = await this.queryContent(data.children)\n      }\n      this.json({\n        data,\n        isError: false\n      })\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: false\n      })\n    }\n  }\n  async getfileAction() {\n    try {\n      const data = await fse.readFile(this.get('path'), 'utf8')\n      this.json({\n        data: this.toCode(data),\n        isError: false\n      })\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async savefileAction() {\n    try {\n      const exist = await fs.existsSync(this.post('path'))\n      if (exist) {\n        fse.outputFile(this.post('path'), this.toCode(this.post('content')).toString())\n        this.json({\n          isError: false,\n        })\n      } else {\n        throw ('file is not exist')\n      }\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async newAction() {\n    try {\n      const { data, isError } = await this.fileCommand(`cd ${this.post('path')};touch ${this.post('filename')}`)\n      this.json({\n        data,\n        isError\n      })\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async deleteAction() {\n    try {\n      const { data, isError } = await this.fileCommand(`cd ${this.post('path')};rm -rf ${this.post('filename')}`)\n      this.json({\n        data,\n        isError\n      })\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async newfolderAction() {\n    try {\n      const { data, isError } = await this.fileCommand(`cd ${this.post('path')};mkdir ${this.post('foldername')}`)\n      this.json({\n        data,\n        isError\n      })\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async renameAction() {\n    try {\n      const exist = await fs.existsSync(this.post('path') + '/' + this.post('newName'))\n      console.log(this.post('path') + '/' + this.post('newName'))\n      if (!exist) {\n        const { data, isError } = await this.fileCommand(`cd ${this.post('path')};mv ${this.post('oldName')} ${this.post('newName')}`)\n        this.json({\n          data,\n          isError\n        })\n      } else {\n        throw (`${this.post('newName')} file already exists!`)\n      }\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async fileCommand(cmd) {\n    try {\n      const data = await new Promise((resolve) => {\n        exec(cmd, (err, stdout, stderr) => {\n          console.log('err==>', err)\n          if (err === null) {\n            if (stderr !== \"\") {\n              stdout = stderr + stdout\n            }\n            resolve({\n              isError: false,\n              message: null,\n              data: stdout && stdout.split('\\n').filter(_stdout => {\n                return _stdout !== ''\n              }),\n              stderr\n            })\n          } else {\n            resolve({\n              isError: true,\n              message: stderr\n            })\n          }\n        })\n      })\n      return data\n    } catch (error) {\n      console.log(error)\n      return {\n        isError: true,\n        error\n      }\n    }\n  }\n  async downloadAction() {\n    let { path, type } = this.get()\n    let name = path.split('/').slice(-1)[0]\n    if (type === 'dir') {\n      // 压缩文件夹\n      await this.fileCommand(`cd ${path}; zip -r ${name}.zip ./*`)\n      path += `/${name}.zip` // 生成压缩文件\n      this.download(path, name + '.zip')\n    } else {\n      this.download(path, name)\n    }\n  }\n}\n"
    ]
}