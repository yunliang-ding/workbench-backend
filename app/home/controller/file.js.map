{
    "version": 3,
    "sources": [
        "../../../src/home/controller/file.js"
    ],
    "names": [
        "dirTree",
        "require",
        "uuidv1",
        "fse",
        "fs",
        "exec",
        "tokens",
        "loginStatusCode",
        "toCode",
        "code",
        "newCCode",
        "i",
        "length",
        "String",
        "fromCharCode",
        "charCodeAt",
        "fromCode",
        "__before",
        "cookie",
        "token",
        "think",
        "isEmpty",
        "loginAction",
        "username",
        "get",
        "password",
        "domain",
        "httponly",
        "json",
        "isError",
        "queryContent",
        "data",
        "res",
        "_data",
        "type",
        "push",
        "concat",
        "children",
        "content",
        "readFileSync",
        "path",
        "filelistAction",
        "param",
        "extensions",
        "exclude",
        "console",
        "log",
        "error",
        "getfileAction",
        "readFile",
        "savefileAction",
        "existsSync",
        "post",
        "exist",
        "outputFile",
        "toString",
        "newAction",
        "fileCommand",
        "deleteAction",
        "newfolderAction",
        "renameAction",
        "cmd",
        "resolve",
        "err",
        "stdout",
        "stderr",
        "message",
        "split",
        "filter",
        "_stdout",
        "downloadAction",
        "name",
        "slice",
        "download",
        "Base"
    ],
    "mappings": "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",
    "file": "../../../src/home/controller/file.js",
    "sourcesContent": [
        "'use strict';\nimport Base from './base.js';\nconst dirTree = require(\"directory-tree\");\nconst uuidv1 = require('uuid/v1');\nconst fse = require('fs-extra')\nconst fs = require('fs')\nconst { exec } = require('child_process')\nconst tokens = {}\nlet loginStatusCode = 0\nexport default class extends Base {\n  /**\n   * @return {Promise} []\n   */\n  __before() {\n    // this.header('Access-Control-Allow-Origin', this.header('origin') || '*');\n    // this.header('Access-Control-Allow-Headers', 'x-requested-with');\n    // this.header('Access-Control-Request-Method', 'GET,POST,PUT,DELETE');\n    // this.header('Access-Control-Allow-Credentials', 'true');\n    let { token } = this.cookie()\n    if (!token in tokens || think.isEmpty(token)) {\n      loginStatusCode = -1\n    } else {\n      loginStatusCode = 0\n    }\n  }\n  toCode = (code) => {  //加密字符串\n    let newCCode = ''\n    for (let i = 0; i < code.length; i++) {\n      newCCode += String.fromCharCode(code[i].charCodeAt() - 1)\n    }\n    return newCCode\n  }\n  fromCode = (code) => { //解密字符串\n    let newCCode = ''\n    for (let i = 0; i < code.length; i++) {\n      newCCode += String.fromCharCode(code[i].charCodeAt() + 1)\n    }\n    return newCCode\n  }\n  async loginAction() {\n    const username = this.get('username')\n    const password = this.get('passward')\n    if (username === 'admin' && password === 'admin') {\n      let token = uuidv1()\n      tokens[token] = {\n        username\n      }\n      this.cookie('token', token, {\n        domain: '127.0.0.1',\n        httponly: true // 只能通过http请求\n      })\n      this.json({\n        isError: false\n      })\n    } else {\n      this.json({\n        isError: true\n      })\n    }\n  }\n  async queryContent(data) {\n    let res = []\n    for (let i = 0; i < data.length; i++) {\n      let _data = data[i]\n      if (_data.type === 'directory') {\n        res.push(_data)\n        res.concat(this.queryContent(_data.children))\n      } else {\n        _data.content = fse.readFileSync(_data.path, 'utf8')\n        res.push(_data)\n      }\n    }\n    return res\n  }\n  async filelistAction() {\n    let param = this.get('createModel') ? {\n      extensions: /\\.js|.jsx|.ts|.tsx/,\n      exclude: /node_modules|.DS_Store|.git/\n    } : {\n      exclude: /node_modules|.DS_Store/\n    }\n    try {\n      const data = dirTree(this.get('path'), param)\n      if(this.get('createModel')){\n        data.children = await this.queryContent(data.children)\n      }\n      this.json({\n        data,\n        loginStatusCode,\n        isError: false\n      })\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: false\n      })\n    }\n  }\n  async getfileAction() {\n    try {\n      const data = await fse.readFile(this.get('path'), 'utf8')\n      this.json({\n        data: this.toCode(data),\n        loginStatusCode,\n        isError: false\n      })\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async savefileAction() {\n    try {\n      const exist = await fs.existsSync(this.post('path'))\n      if(exist){\n        fse.outputFile(this.post('path'), this.toCode(this.post('content')).toString())\n        this.json({\n          isError: false,\n          loginStatusCode,\n        })\n      } else {\n        throw('file is not exist')\n      }\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async newAction() {\n    try {\n      const { data, isError } = await this.fileCommand(`cd ${this.post('path')};touch ${this.post('filename')}`)\n      this.json({\n        data,\n        isError\n      })\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async deleteAction() {\n    try {\n      const { data, isError } = await this.fileCommand(`cd ${this.post('path')};rm -rf ${this.post('filename')}`)\n      this.json({\n        data,\n        isError\n      })\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async newfolderAction() {\n    try {\n      const { data, isError } = await this.fileCommand(`cd ${this.post('path')};mkdir ${this.post('foldername')}`)\n      this.json({\n        data,\n        isError\n      })\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async renameAction() {\n    try {\n      const exist = await fs.existsSync(this.post('path') + '/' + this.post('newName'))\n      console.log(this.post('path') + '/' + this.post('newName'))\n      if(!exist){\n        const { data, isError } = await this.fileCommand(`cd ${this.post('path')};mv ${this.post('oldName')} ${this.post('newName')}`)\n        this.json({\n          data,\n          isError\n        })\n      } else {\n        throw(`${this.post('newName')} file already exists!`)\n      }\n    } catch (error) {\n      console.log(error)\n      this.json({\n        error,\n        isError: true\n      })\n    }\n  }\n  async fileCommand(cmd) {\n    try {\n      const data = await new Promise((resolve) => {\n        exec(cmd, (err, stdout, stderr) => {\n          console.log('err==>', err)\n          if (err === null) {\n            if (stderr !== \"\") {\n              stdout = stderr + stdout\n            }\n            resolve({\n              isError: false,\n              message: null,\n              data: stdout && stdout.split('\\n').filter(_stdout => {\n                return _stdout !== ''\n              }),\n              stderr\n            })\n          } else {\n            resolve({\n              isError: true,\n              message: stderr\n            })\n          }\n        })\n      })\n      return data\n    } catch (error) {\n      console.log(error)\n      return {\n        isError: true,\n        error\n      }\n    }\n  }\n  async downloadAction(){\n    let { path, type } = this.get()\n    let name = path.split('/').slice(-1)[0]\n    if(type === 'dir'){\n      // 压缩文件夹\n      await this.fileCommand(`cd ${path}; zip -r ${name}.zip ./*`)\n      path += `/${name}.zip` // 生成压缩文件\n      this.download(path, name + '.zip')\n    } else {\n      this.download(path, name)\n    }\n  }\n}\n"
    ]
}